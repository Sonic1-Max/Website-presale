<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonic Presale Swap</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: #0a0a15;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                45deg,
                #8a2be2 0%,
                #00ffcc 20%,
                #ff1493 40%,
                #00ff00 60%,
                #8a2be2 80%
            );
            background-size: 200% 200%;
            animation: movingLines 10s linear infinite;
            opacity: 0.2;
            z-index: -1;
        }

        @keyframes movingLines {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        .swap-container {
            background: rgba(10, 10, 20, 0.9);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 40px rgba(138, 43, 226, 0.6), inset 0 0 15px rgba(0, 255, 204, 0.3);
            width: 100%;
            max-width: 480px;
            text-align: center;
            border: 2px solid #00ffcc;
            position: relative;
            z-index: 1;
        }

        .description {
            font-size: 14px;
            color: #00ffcc;
            text-shadow: 0 0 8px #00ffcc;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(20, 20, 40, 0.9);
            border-radius: 10px;
            border: 1px solid #ff00ff;
        }

        .description a {
            color: #ff00ff;
            text-decoration: underline;
            cursor: pointer;
        }

        .timer {
            font-size: 24px;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #8a2be2, #00ffcc);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.5);
            border: 1px solid #ff1493;
            color: #fff;
        }

        .progress-section {
            margin-bottom: 25px;
        }

        .progress-text {
            font-size: 16px;
            color: #00ffcc;
            text-shadow: 0 0 8px #00ffcc;
            margin-bottom: 10px;
        }

        .progress-bar-container {
            width: 100%;
            background: rgba(20, 20, 40, 0.9);
            border-radius: 10px;
            height: 20px;
            border: 2px solid #ff1493;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ffcc, #ff00ff, #00ff00);
            transition: width 0.5s ease;
        }

        .token-box {
            background: rgba(20, 20, 40, 0.9);
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 0 25px rgba(255, 20, 147, 0.4);
            border: 2px solid #ff00ff;
            transition: transform 0.3s;
        }

        .token-box:hover {
            transform: scale(1.02);
            box-shadow: 0 0 35px rgba(255, 20, 147, 0.6);
        }

        .token-box img {
            width: 45px;
            height: 45px;
            margin-right: 15px;
            filter: drop-shadow(0 0 8px #00ffcc);
        }

        .token-box input {
            background: transparent;
            border: none;
            color: #00ffcc;
            font-size: 20px;
            width: 100%;
            outline: none;
        }

        .token-box input::placeholder {
            color: #66cccc;
        }

        .token-symbol {
            font-size: 20px;
            font-weight: bold;
            color: #ff00ff;
            text-shadow: 0 0 8px #ff00ff;
        }

        .swap-arrow {
            font-size: 30px;
            color: #00ff00;
            margin: 15px 0;
            text-shadow: 0 0 12px #00ff00;
        }

        .price-info {
            font-size: 16px;
            color: #00ffcc;
            margin: 15px 0;
            text-shadow: 0 0 8px #00ffcc;
        }

        button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
            text-transform: uppercase;
        }

        .connect-wallet {
            background: linear-gradient(90deg, #ff00ff, #8a2be2);
            color: #fff;
            box-shadow: 0 0 25px rgba(255, 0, 255, 0.6);
        }

        .connect-wallet:hover {
            background: linear-gradient(90deg, #8a2be2, #ff00ff);
            transform: translateY(-2px);
            box-shadow: 0 0 35px rgba(255, 0, 255, 0.8);
        }

        .disconnect-wallet {
            background: linear-gradient(90deg, #ff5555, #ff0000);
            color: #fff;
            box-shadow: 0 0 25px rgba(255, 85, 85, 0.6);
        }

        .disconnect-wallet:hover {
            background: linear-gradient(90deg, #ff0000, #ff5555);
            transform: translateY(-2px);
            box-shadow: 0 0 35px rgba(255, 85, 85, 0.8);
        }

        .buy-btn {
            background: linear-gradient(90deg, #00ffcc, #00ff00);
            color: #000;
            box-shadow: 0 0 25px rgba(0, 255, 204, 0.6);
        }

        .buy-btn:hover {
            background: linear-gradient(90deg, #00ff00, #00ffcc);
            transform: translateY(-2px);
            box-shadow: 0 0 35px rgba(0, 255, 204, 0.8);
        }

        .wallet-info {
            font-size: 14px;
            color: #00ffcc;
            text-shadow: 0 0 8px #00ffcc;
            margin-top: 15px;
            word-wrap: break-word;
        }

        .transaction-status {
            font-size: 14px;
            color: #ff00ff;
            text-shadow: 0 0 8px #ff00ff;
            margin-top: 10px;
        }

        .loader {
            display: none;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #00ffcc;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsivitas */
        @media (max-width: 480px) {
            .swap-container {
                padding: 15px;
                max-width: 90%;
            }
            .timer, .progress-text, .price-info {
                font-size: 14px;
            }
            .token-box input, .token-symbol {
                font-size: 16px;
            }
            button {
                font-size: 16px;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="swap-container">
        <div class="description">
            <strong>Important: If Connect Wallet doesn't work, please use a wallet browser such as OKX, Binance, Trust, etc. Access the presale here: <a href="https://buysonic.netlify.app/" onclick="copyLink(event)">https://buysonic.netlify.app/</a> (click to copy)</strong><br><br>
            Sonic is a high-speed meme coin driven by the community and built on the BNB Smart Chain. Inspired by the concept of speed and innovation, Sonic aims to revolutionize the meme coin world with ultra-fast transactions, low fees, and strong community engagement. By leveraging viral marketing and strategic liquidity management, Sonic is positioned to become a major player in the crypto ecosystem.
        </div>
        
        <div class="timer" id="countdown">Calculating...</div>
        
        <div class="progress-section">
            <div class="progress-text" id="progressText">Sold: 800 / 100,000,000 SONIC (0.0008%)</div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 0.0008%;"></div>
            </div>
        </div>

        <div class="token-box">
            <img src="https://cryptologos.cc/logos/binance-coin-bnb-logo.png" alt="BNB Logo">
            <input type="number" id="bnbInput" placeholder="0.0" min="0" max="10" oninput="calculateSonic()">
            <span class="token-symbol">BNB</span>
        </div>

        <div class="swap-arrow">â†“</div>

        <div class="token-box">
            <img src="sonic-logo.png" alt="Sonic Logo">
            <input type="number" id="sonicOutput" placeholder="0.0" readonly>
            <span class="token-symbol">SONIC</span>
        </div>

        <div class="price-info">1 SONIC = 0.0000006 BNB (Max 10 BNB)</div>

        <button class="connect-wallet" id="connectBtn" onclick="connectWallet()">Connect Wallet</button>
        <button class="disconnect-wallet" id="disconnectBtn" onclick="disconnectWallet()" style="display: none;">Disconnect Wallet</button>
        <div class="wallet-info" id="walletInfo" style="display: none;"></div>
        <div class="loader" id="loader"></div>
        <div class="transaction-status" id="txStatus" style="display: none;"></div>
        <button class="buy-btn" id="buyBtn" onclick="buySonic()">Buy SONIC</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.4/dist/web3.min.js"></script>
    <script>
        const SONIC_PRICE = 0.0000006; // Harga Sonic dalam BNB
        const PRESALE_ADDRESS = "0xbFeF8dDAe0880e990E8be4dDbe3eed216eCb66c8";
        const MAX_BNB = 10; // Maksimum pembelian 10 BNB
        const MAX_SONIC = 100000000; // Maksimum SONIC yang dijual
        let soldSonic = 816; // SONIC yang sudah terjual
        let web3; // Variabel untuk Web3 instance
        let userAccount; // Menyimpan alamat wallet pengguna

        // Tanggal deploy: 7 Maret 2025
        const deployDate = new Date("March 07, 2025 00:00:00 GMT+00:00");
        // Tanggal akhir presale: 83 hari setelah deploy
        const endDate = new Date(deployDate);
        endDate.setDate(deployDate.getDate() + 83);

        function updateCountdown() {
            const now = new Date();
            const timeLeft = endDate - now;

            if (timeLeft <= 0) {
                document.getElementById("countdown").innerText = "0d 0h 0m 0s";
                return;
            }

            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

            document.getElementById("countdown").innerText = 
                `${days}d ${hours}h ${minutes}m ${seconds}s`;
        }

        function updateProgress() {
            const percentage = (soldSonic / MAX_SONIC) * 100;
            document.getElementById("progressText").innerText = 
                `Sold: ${soldSonic.toLocaleString()} / ${MAX_SONIC.toLocaleString()} SONIC (${percentage.toFixed(4)}%)`;
            document.getElementById("progressBar").style.width = `${percentage}%`;
        }

        // Simulasi pembaruan progress real-time (idealnya dari kontrak)
        setInterval(() => {
            // Di sini bisa diganti dengan panggilan ke kontrak pintar
            updateProgress();
        }, 5000);

        setInterval(updateCountdown, 1000);
        updateCountdown();
        updateProgress();

        function calculateSonic() {
            let bnbAmount = parseFloat(document.getElementById("bnbInput").value);
            if (bnbAmount > MAX_BNB) {
                bnbAmount = MAX_BNB;
                document.getElementById("bnbInput").value = MAX_BNB;
                alert("Maximum purchase is 10 BNB!");
            }
            const sonicAmount = bnbAmount / SONIC_PRICE;
            document.getElementById("sonicOutput").value = isNaN(sonicAmount) ? "0.0" : sonicAmount.toFixed(2);
        }

        async function connectWallet() {
            if (window.ethereum) {
                const loader = document.getElementById("loader");
                loader.style.display = "block";
                try {
                    web3 = new Web3(window.ethereum);
                    const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
                    userAccount = accounts[0];

                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0x38' }],
                    });

                    const balanceWei = await web3.eth.getBalance(userAccount);
                    const balanceBNB = web3.utils.fromWei(balanceWei, 'ether');

                    const walletInfo = document.getElementById("walletInfo");
                    walletInfo.innerText = `Address: ${userAccount}\nBalance: ${parseFloat(balanceBNB).toFixed(4)} BNB`;
                    walletInfo.style.display = 'block';

                    document.getElementById("connectBtn").style.display = 'none';
                    document.getElementById("disconnectBtn").style.display = 'block';

                    alert("Wallet connected!");
                } catch (error) {
                    alert("Failed to connect wallet: " + error.message);
                } finally {
                    loader.style.display = "none";
                }
            } else {
                alert("Please install MetaMask or another Web3 wallet!");
            }
        }

        function disconnectWallet() {
            web3 = null;
            userAccount = null;
            document.getElementById("walletInfo").style.display = 'none';
            document.getElementById("txStatus").style.display = 'none';
            document.getElementById("connectBtn").style.display = 'block';
            document.getElementById("disconnectBtn").style.display = 'none';
            alert("Wallet disconnected!");
        }

        async function buySonic() {
            const bnbAmount = parseFloat(document.getElementById("bnbInput").value);
            if (!bnbAmount || bnbAmount <= 0) {
                alert("Please enter a valid BNB amount!");
                return;
            }
            if (bnbAmount > MAX_BNB) {
                alert("Maximum purchase is 10 BNB!");
                return;
            }

            const sonicToBuy = bnbAmount / SONIC_PRICE;
            if (soldSonic + sonicToBuy > MAX_SONIC) {
                alert("Not enough SONIC remaining for this purchase!");
                return;
            }

            if (!web3 || !userAccount) {
                alert("Please connect your wallet first!");
                return;
            }

            const balanceWei = await web3.eth.getBalance(userAccount);
            const balanceBNB = parseFloat(web3.utils.fromWei(balanceWei, 'ether'));
            if (bnbAmount > balanceBNB) {
                alert("Insufficient BNB balance!");
                return;
            }

            const loader = document.getElementById("loader");
            const txStatus = document.getElementById("txStatus");
            const buyBtn = document.getElementById("buyBtn");
            loader.style.display = "block";
            txStatus.style.display = "block";
            txStatus.innerText = "Transaction pending...";
            buyBtn.disabled = true;

            try {
                const weiAmount = web3.utils.toWei(bnbAmount.toString(), "ether");
                const tx = await web3.eth.sendTransaction({
                    from: userAccount,
                    to: PRESALE_ADDRESS,
                    value: weiAmount
                });
                soldSonic += sonicToBuy;
                updateProgress();

                const newBalanceWei = await web3.eth.getBalance(userAccount);
                const newBalanceBNB = web3.utils.fromWei(newBalanceWei, 'ether');
                document.getElementById("walletInfo").innerText = 
                    `Address: ${userAccount}\nBalance: ${parseFloat(newBalanceBNB).toFixed(4)} BNB`;

                txStatus.innerText = `Transaction successful! Tx Hash: ${tx.transactionHash}\nView on BscScan: https://bscscan.com/tx/${tx.transactionHash}`;
                alert("Purchase successful!");
            } catch (error) {
                txStatus.innerText = `Transaction failed: ${error.message}`;
                alert("Purchase failed: " + error.message);
            } finally {
                loader.style.display = "none";
                buyBtn.disabled = false;
            }
        }

        function copyLink(event) {
            event.preventDefault();
            const link = "https://buysonic.netlify.app/";
            navigator.clipboard.writeText(link).then(() => {
                alert("Link copied to clipboard: " + link);
            }).catch(err => {
                alert("Failed to copy link: " + err);
            });
        }
    </script>
</body>
</html>